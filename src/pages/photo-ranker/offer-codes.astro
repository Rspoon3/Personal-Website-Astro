---
import AppHead from "../../components/AppHead.astro";
import Header from "../../components/Header.astro";
import LandingPageFooter from "../../components/LandingPageFooter.astro";
import OfferCodeList from "../../components/OfferCodesGrid.astro";

import appIcon from "../../images/photo-ranker/appIcon.png";
import apps from "../../json/apps.json";
import fs from "fs";
import path from "path";

const photoRanker = apps.find((app) => app.title === "Photo Ranker");
const appLink = photoRanker.appId ? `https://apps.apple.com/us/app/id${photoRanker.appId}` : null;

// Read and parse CSV file
const csvPath = path.join(process.cwd(), "src/data/PhotoRankerOfferCodes.csv");
const csvContent = fs.readFileSync(csvPath, "utf-8");
const offerCodes = csvContent
  .trim()
  .split("\n")
  .map((line) => {
    const [code, url] = line.split(",");
    return { code, url };
  });
---

<html lang="en">
  <AppHead title="Photo Ranker - Offer Codes" appId={photoRanker.appId} />
  <body class="text-white" style="background-color: #1a1a1a;">
    <Header
      title={photoRanker.title}
      appIcon={appIcon}
      appLink={appLink}
      offerCodesLink="/photo-ranker/offer-codes"
      detailsPageLink="/photo-ranker"
    />
    <OfferCodeList
      offerCodes={offerCodes}
      appName="Photo Ranker"
    />
    <LandingPageFooter bgColor="#0a0a0a" />
  </body>
</html>
